Comparison of Tax-Calculator and TAXCALC SAS results
=====================================================

This directory includes tools used to compare the income tax results
generated by Tax-Calculator with results generated by the [TAXCALC SAS
program](http://www.nber.org/taxcalc) developed by Dan Feenberg and
Ina Shapiro of NBER with assistance from IRS-SOI staff.

The tools included in this directory support the following
cross-model-comparison work flow:

  1. Generate a sample of tax filing units (INPUT).
  2. Generate OUTPUT from INPUT using the inctax.py script.
  3. Generate OUTPUT from INPUT using the TAXCALC SAS program.
  4. Generate tax differences by comparing the two OUTPUT files.


First comparison: methods and results
-------------------------------------

(1) The INPUT file used in the first comparison is generated as
follows:

```
$ cd taxcalc/taxcalcsas
```

```
$ tclsh ../validation/make-in.tcl 2013 c > c13.in
```

The ```c13.in``` file is in Internet-TAXSIM format, so we
convert that file to CSV format as follows:

```
$ python ../../simtax.py --taxsim2441 --records c13.in
```

We rename the file generated by the ```--records``` option, as follows:

 ```
$ mv c13.in.records c13.csv
```

We process the renamed INPUT file with the ```inctax.py``` command-line
interface to Tax-Calculator as follows:

```
$ python ../../inctax.py c13.csv 2013
```

The resulting OUTPUT file is identical to that produced by the
```simtax.py``` command-line interface to Tax-Calculator because
the following command produces no difference output:

```
$ diff c13-13.out-inctax c13.in.out-simtax
```

So, the contents of the ```c13.in``` and ```c13.csv``` files are identical
in the sense that they generate the exact same Tax-Calculator OUTPUT files:
```c13.in.out-simtax```, which is generated by the ```simtax.py```
command-line interface to the Tax-Calculator using ```c13.in``` as
INPUT, and ```c13-13.out-inctax```, which is generated by the
```inctax.py``` command-line interface to the Tax-Calculator using
```c13.csv``` as INPUT.

(2) The Tax-Calculator OUTPUT file is the ```c13-13.out-inctax``` file.

(3) The TAXCALC SAS OUTPUT file, which is called ```c13.out-sas```, has
been generated by TAXCALC SAS using a modified ```c13.csv``` file as input.
This modification does not change any data values; it simply translates
variable names (on the first header row of the ```c13.csv``` file) from
names used by Tax-Calculator to names used by TAXCALC SAS.
This variable-name translation is accomplished as follows:

```
$ python in2sas.py c13.csv c13sas.csv
```

(4) The comparison of the two OUTPUT files is accomplished with the
following sequence of commands:

```
$ cp c13-13.out-inctax py-out
```

After shortening the Tax-Calculator OUTPUT file name, we convert the
TAXCALC SAS OUTPUT file from CSV format to Internet-TAXSIM output format
as follows:

```
$ python sas2out.py c13.out-sas sas-out
```

Then the ```py-out``` and ```sas-out``` files are compared using the
```taxcalc/validation/taxdiffs.tcl``` tool (restricting the comparison
to output variables generated by the TAXCALC SAS program):

```
$ tclsh ../validation/taxdiffs.tcl --taxcalc py-out sas-out > c13-13.taxdiffs
```

The content of the ```c13-13.taxdiffs``` file generated on ??-Apr-2016
is as follows:

```
TAXDIFFS GO HERE
```

DESCRIPTION OF TAXDIFFS GOES HERE.


Second comparison: methods and results
--------------------------------------

...
