Comparison of Tax-Calculator and TAXCALC SAS results
=====================================================

This directory includes tools used to compare the income tax results
generated by Tax-Calculator with results generated by the [TAXCALC SAS
program](http://www.nber.org/taxcalc) developed by Dan Feenberg and
Ina Shapiro of NBER with assistance from IRS-SOI staff.

The tools included in this directory support the following
cross-model-comparison work flow:

  1. Generate a sample of tax filing units (INPUT).
  2. Generate OUTPUT from INPUT using the inctax.py script.
  3. Generate OUTPUT from INPUT using the TAXCALC SAS program.
  4. Generate tax differences by comparing the two OUTPUT files.


First comparison: methods and results
-------------------------------------

(1) The INPUT file used in the first comparison is generated as
follows:

```
cd taxcalc/taxcalcsas
tclsh ../validation/make-in.tcl 2013 a > a13.in
```

The `a13.in` file is in Internet-TAXSIM format, so we
convert that file to CSV format as follows:

```
python ../../simtax.py --taxsim2441 --records a13.in
```

We rename the file generated by the `--records` option, as follows:

```
mv a13.in.records a13.csv
```

We process the renamed INPUT file with the `inctax.py` command-line
interface to Tax-Calculator as follows:

```
python ../../inctax.py a13.csv 2013
```

The resulting OUTPUT file is identical to that produced by the
`simtax.py` command-line interface to Tax-Calculator because
the following command produces no difference output:

```
diff a13-13.out-inctax a13.in.out-simtax
```

So, the contents of the `a13.in` and `a13.csv` files are identical
in the sense that they generate the exact same Tax-Calculator OUTPUT files:
`a13.in.out-simtax`, which is generated by the `simtax.py`
command-line interface to the Tax-Calculator using `a13.in` as
INPUT, and `a13-13.out-inctax`, which is generated by the
`inctax.py` command-line interface to the Tax-Calculator using
`a13.csv` as INPUT.

(2) The Tax-Calculator OUTPUT file is the `a13-13.out-inctax` file.

(3) The TAXCALC SAS OUTPUT file, which is called `a13.out-sas`,
has been generated by TAXCALC SAS using a this `a13.csv` file as
input.  The TAXCALC SAS script is by the [compare.sas script](https://github.com/open-source-economics/Tax-Calculator/blob/master/taxcalc/taxcalcsas/compare.sas).

(4) The comparison of the two OUTPUT files is accomplished with the
following sequence of commands:

```
cp a13-13.out-inctax py-out
```

After shortening the Tax-Calculator OUTPUT file name, we convert the
TAXCALC SAS OUTPUT file from CSV format to Internet-TAXSIM output format
as follows:

```
python sas2out.py a13.out-sas sas-out
```

Then the `py-out` and `sas-out` files are compared using the
`taxcalc/validation/taxdiffs.tcl` tool (restricting the comparison
to output variables generated by the TAXCALC SAS program):

```
tclsh ../validation/taxdiffs.tcl --taxcalc py-out sas-out > a13-13.taxdiffs
```

The content of the `a13-13.taxdiffs` file generated on 19-Apr-2016
is as follows:

```
TAXDIFF:ovar,#diffs,#1cdiffs,maxdiff[id]= 19     52     52      0.01 [874]
TAXDIFF:ovar,#diffs,#1cdiffs,maxdiff[id]= 25     36     36      0.01 [2633]
TAXDIFF:ovar,#diffs,#1cdiffs,maxdiff[id]= 27     71     71      0.01 [2665]
TAXDIFF:ovar,#diffs,#1cdiffs,maxdiff[id]= 28     49     49      0.01 [874]
TAXDIFF:ovar,#diffs,#1cdiffs,maxdiff[id]=  4     54     54     -0.01 [17158]
```

These results show that there are no differences in federal income tax
liabilities, or in intermediate tax amounts, greater than one cent.
However, these results ignore the fact that the current version of
Tax-Calculator does not calculate the Schedule R tax credit; instead
it reads it in from a more comprehensive input file than `a13.csv`.


Second comparison: methods and results
--------------------------------------

...
