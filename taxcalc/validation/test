#!/bin/bash
# Executes current-law validation TEST using Tax-Calculator SimpleTaxIO class
# as follows:
# (1) generate a random sample of tax filing units (INPUT),
# (2) generate OUTPUT from INPUT using simtax.py, and
# (3) generate tax-difference tabulations by comparing OUTPUT with
#     output file generated by Internet-TAXSIM using the same INPUT.
# Check number of command-line arguments
if [[ "$#" -ne 1 ]]; then
    echo "ERROR: not exactly one command-line argument"
    echo "USAGE: ./test LYY"
    echo "       where L is letter in [a,b,c] and YY is number in [13,14]"
    exit 1
fi
LYY=$1
# Specify simtax.py options appropriate for validation tests
OPTIONS="--taxsim2441"
# Execute the specified validation test
L=${LYY:0:1}    
YY=${LYY:1:2}
tclsh make-in.tcl 20$YY $L > $LYY.in
python ../../simtax.py $OPTIONS $LYY.in
unzip -oq out-taxsim.zip $LYY.in.out-taxsim
tclsh taxdiffs.tcl $LYY.in.out-simtax $LYY.in.out-taxsim > $LYY.taxdiffs
git diff --name-status $LYY.taxdiffs
rm $LYY.in $LYY.in.out-simtax $LYY.in.out-taxsim
exit 0
